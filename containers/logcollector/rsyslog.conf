# Configuration rsyslog serveur pour réception des logs

$ModLoad imuxsock
$ModLoad imudp
$UDPServerRun 514
$WorkDirectory /var/lib/rsyslog
$ActionFileDefaultTemplate RSYSLOG_TraditionalFileFormat

# Activer la réception UDP sur toutes les interfaces
$UDPServerAddress 0.0.0.0

# Réception des logs du firewall
# Template pour les logs avec nom de fichier basé sur la date
$template FirewallLogs,"/var/log/firewall/firewall_%$YEAR%-%$MONTH%-%$DAY%.log"

# Filtrer et stocker uniquement les logs intéressants (kernel, UFW, réseau)
# Ignorer les logs rsyslog internes (mais garder les logs UFW même s'ils contiennent "kernel:")
:msg, contains, "rsyslogd" ~
:msg, contains, "imjournal" ~
:msg, contains, "imuxsock" ~
:msg, contains, "environment variable TZ is not set" ~

# PRIORITÉ : Stocker tous les logs kernel (où UFW écrit)
kern.* ?FirewallLogs
# Envoyer aussi à Splunk en UDP (@@ = UDP, @ = TCP)
kern.* @@splunk:514

# Stocker aussi les logs tagués kernel-ufw
kernel-ufw:* ?FirewallLogs
# Envoyer aussi à Splunk en UDP
kernel-ufw:* @@splunk:514

# Stocker tous les autres logs reçus (fallback)
*.* ?FirewallLogs
# Envoyer aussi à Splunk en UDP
*.* @@splunk:514

# Logs locaux (fallback)
*.info;mail.none;authpriv.none;cron.none /var/log/messages
authpriv.* /var/log/secure
cron.* /var/log/cron



